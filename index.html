<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>T.R.O.A.T. â€“ Training Repetitive Oral Attention Techniques</title>
<style>
  :root {
    --bg: #fff0f5;   /* very light pink */
    --pink1: #ffb6c1;/* soft pink */
    --pink2: #ff69b4;/* hot pink */
    --accent: #880044;
  }
  html, body {
    margin: 0; height: 100%;
    background: var(--bg);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    color: var(--accent);
    overflow: hidden;
    user-select: none; -webkit-user-select: none;
  }

  main {
    height: 100%;
    display: flex; align-items: center; justify-content: center;
    text-align: center; padding: 24px; box-sizing: border-box;
  }

  /* First Enter Screen (White, Minimalist) */
  #enter-screen {
    position: fixed; inset: 0; background: white;
    display: flex; align-items: center; justify-content: center;
    flex-direction: column; z-index: 50;
    opacity: 1; transition: opacity 3s;
  }
  #enter-btn {
    background: black; color: white;
    border: none; font-size: 18px; padding: 12px 22px;
    cursor: pointer; border-radius: 0; font-weight: bold;
  }
  #enter-screen.fade-out { opacity: 0; pointer-events: none; }

  /* Intro Screen */
  #start-screen {
    position: fixed; inset: 0; background: var(--bg);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    z-index: 40; opacity: 0; transition: opacity 3s;
  }
  #start-screen.show { opacity: 1; }
  #start-screen button {
    margin-top: 16px; padding: 12px 20px; border: none;
    background: var(--pink2); color: #fff; font-size: 16px; border-radius: 10px; cursor: pointer;
  }

  /* Begging screen */
  #begging-screen {
    position: fixed; inset: 0; display: none; opacity: 0;
    background: var(--bg); z-index: 30;
    flex-direction: column; align-items: center; justify-content: center; text-align: center;
    transition: opacity .4s ease;
  }
  #begging-screen.show { display: flex; opacity: 1; }
  #begging-text { font-size: 1.25rem; margin-bottom: 12px; }

  /* Gentle Break */
  #break-screen {
    position: fixed; inset: 0; display: none; background: var(--bg); z-index: 30;
    flex-direction: column; align-items: center; justify-content: center; text-align: center;
  }

  /* Cum screen */
  #cum-screen {
    position: fixed; inset: 0; display: none; background: var(--bg); z-index: 35;
    flex-direction: column; align-items: center; justify-content: center; text-align: center;
  }

  /* Overlay popups */
  #overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,.4);
    opacity: 0; pointer-events: none; transition: opacity .4s; z-index: 10;
  }
  #overlay.show { opacity: 1; pointer-events: auto; }
  .panel {
    position: fixed; left: 50%; top: 50%; transform: translate(-50%,-50%) scale(.95);
    background: #fff; padding: 18px 22px; border-radius: 12px; border: 2px solid var(--pink2);
    box-shadow: 0 8px 26px rgba(0,0,0,.15); color: var(--accent); text-align: center;
    opacity: 0; z-index: 11; transition: opacity .4s ease, transform .4s ease;
  }
  .panel.show { opacity: 1; transform: translate(-50%,-50%) scale(1); }

  /* Scene transition (blank fade) */
  #transition-screen {
    position: fixed; inset: 0; background: var(--bg); opacity: 0; z-index: 20; pointer-events: none;
    transition: opacity .5s; display: flex; align-items: center; justify-content: center;
  }
  #transition-screen.show { opacity: 1; }

  /* Meters */
  .meter {
    width: 80%; max-width: 720px; height: 20px; background: var(--bg);
    border: 2px solid var(--pink1); border-radius: 12px; overflow: hidden; margin: 12px auto;
  }
  .meter-fill {
    height: 100%; width: 0%;
    background: var(--pink1); border-right: 2px solid var(--pink2);
    transition: width .08s linear, background .1s;
  }

  /* Waveforms */
  #waveform, #waveform-main {
    display: block; margin: 6px auto; width: 80%; max-width: 720px; height: 30px;
    background: var(--bg); border: 1px solid var(--pink1); border-radius: 8px;
  }

  /* Hearts splash */
  #hearts-container {
    position: absolute; top: 50%; left: 50%; pointer-events: none; z-index: 50;
  }
  .heart {
    position: absolute; font-size: 16px; color: var(--pink2); opacity: 0;
    animation: floatUp .6s ease forwards;
  }
  @keyframes floatUp {
    0% { transform: translate(-50%, 0) scale(.8) rotate(0deg); opacity: 0; }
    30%{ opacity:1; }
    100%{ transform: translate(-50%, -50px) scale(1) rotate(8deg); opacity:0; }
  }
</style>
</head>
<body>

<!-- ENTER SCREEN -->
<div id="enter-screen">
  <button id="enter-btn">ENTER</button>
</div>

<!-- INTRO SCREEN -->
<div id="start-screen">
  <h1><b>ðŸ©· T.R.O.A.T. ðŸ©·</b></h1>
  <p><b>Training Repetitive Oral Attention Techniques</b></p>
  <button id="beginBtn">Begin Training</button>
</div>

<!-- Begging Screen -->
<div id="begging-screen">
  <div id="begging-text"></div>
  <canvas id="waveform" width="400" height="30"></canvas>
  <div class="meter"><div class="meter-fill" id="begFill"></div></div>
</div>

<!-- Break Screen -->
<div id="break-screen">
  <h2>Gentle Break</h2>
  <p>Take a moment.<br>You did so well.<br>Breathe and get ready for what's coming...</p>
  <div class="meter"><div class="meter-fill" id="breakFill"></div></div>
</div>

<!-- Cum Scene -->
<div id="cum-screen">
  <h2>Good Girl...</h2>
  <div class="meter" id="cumMeter"><div class="meter-fill" id="cumFill"></div></div>
  <div id="hearts-container"></div>
</div>

<!-- Overlay / Popup -->
<div id="overlay"></div>
<div id="popup" class="panel"></div>

<!-- Transition -->
<div id="transition-screen"></div>

<!-- Main Scene -->
<main>
  <div class="card">
    <h2 id="sceneTitle"></h2>
    <p id="line1"></p><p id="line2"></p><p id="line3"></p>
    <canvas id="waveform-main" width="400" height="30"></canvas>
    <div class="meter"><div class="meter-fill" id="fill"></div></div>
  </div>
</main>

<!-- Sounds -->
<audio id="chime"   src="audio/Ding01.mp3" preload="auto"></audio>
<audio id="popSound" src="audio/pop01.mp3" preload="auto"></audio>
<audio id="enterSound" src="audio/enterClick.mp3" preload="auto"></audio>
<script>
/* --------------------------
   Content
--------------------------- */
const beggingScenes = [
  "Welcome.<br>You are here to learn discipline, control, and devotion.<br>This training will teach you to serve with your mouth, to beg for every inch, and to please every cock put in front of you.<br><br><em>Are you ready to serve?</em>",
  "You begged well.<br>What do you want?<br><br><em>Say 'cock' to continue.</em>",
  "This is your first challenge.<br>Beg to taste it.<br>Beg to worship it.<br><br><em>Say 'please' to continue.</em>"
];

const begForCumScene =
  "Beg for his release.<br>Tell him how much you want it.<br><br><em>Say 'please' to continue.</em>";

const cumEndings = [
  "Good Girl, he cums all over your face!",
  "Good Girl, he shoots down your throat!",
  "Good Girl, he covers your breasts with his release!",
  "Good Girl, he spills hot cum across your tongue!",
  "Good Girl, he empties himself into your mouth!",
  "Good Girl, he coats your lips and chin!",
  "Good Girl, he paints your cheeks with every drop!",
  "Good Girl, he fills your mouth until it overflows!",
  "Good Girl, warm release drips down your body!",
  "Good Girl, he lets it all out just for you!"
];

const scenes = [
  { title: "Cock_1 â€“ Gentle Tip Teasing",   lines: ["Kiss the tip.","Gentle teasing, don't be greedy.","Show him how much you want it!"], goal: 100 },
  { title: "Cock_1 â€“ Gentle Shaft Teasing", lines: ["Slowly lick the shaft.","Up and down, savor every inch.","Don't rush it, make it count."], goal: 100 },
  { title: "Cock_1 â€“ Gentle Ball Teasing",  lines: ["Caress him gently.","Tease every part slowly.","Make him feel worshipped."], goal: 100 },
  { title: "Cock_1 â€“ Gentle Break",         lines: [], goal: 100 }, 
  { title: "Cock_1 â€“ Eager Shaft Teasing",  lines: ["Lick faster now.","Be eager, show enthusiasm.","You're getting him so close..."], goal: 100 },
  { title: "Cock_1 â€“ Final Climax",         lines: ["Push yourself.","He's almost ready to release.","Work harder, don't stop!"], goal: 200 }
];

/* --------------------------
   Refs
--------------------------- */
const enterScreen  = document.getElementById("enter-screen");
const enterBtn     = document.getElementById("enter-btn");
const startScreen  = document.getElementById("start-screen");
const beginBtn     = document.getElementById("beginBtn");

const beggingScreen = document.getElementById("begging-screen");
const beggingText   = document.getElementById("begging-text");
const begFill       = document.getElementById("begFill");

const breakScreen   = document.getElementById("break-screen");
const breakFill     = document.getElementById("breakFill");

const cumScreen     = document.getElementById("cum-screen");
const cumMeter      = document.getElementById("cumMeter");
const cumFill       = document.getElementById("cumFill");
const heartsContainer = document.getElementById("hearts-container");

const sceneTitle    = document.getElementById("sceneTitle");
const line1         = document.getElementById("line1");
const line2         = document.getElementById("line2");
const line3         = document.getElementById("line3");
const fillEl        = document.getElementById("fill");

const overlay       = document.getElementById("overlay");
const popup         = document.getElementById("popup");
const transitionScreen = document.getElementById("transition-screen");

/* Sounds */
const chime         = document.getElementById("chime");
const popSound      = document.getElementById("popSound");
const enterSound    = document.getElementById("enterSound");

/* Waveforms */
const begCanvas     = document.getElementById("waveform");
const begCtx        = begCanvas.getContext("2d");
const mainCanvas    = document.getElementById("waveform-main");
const mainCtx       = mainCanvas.getContext("2d");

/* --------------------------
   State
--------------------------- */
let audioCtx, analyser, micSource, dataArray;
let running = false;
let meterValue = 0;
let currentSceneIndex = 0;
let beggingIndex = 0;
let mode = "idle"; // beg, tease, break, begCum, cum
let wavePhase = 0;

/* --------------------------
   Helpers
--------------------------- */
function showPopup(msg, cb){
  overlay.classList.add("show");
  popup.innerHTML = msg;
  popup.classList.add("show");
  setTimeout(() => {
    popup.classList.remove("show");
    overlay.classList.remove("show");
    if (cb) cb();
  }, 5000);
}

function transitionTo(cb){
  transitionScreen.classList.add("show");
  setTimeout(() => {
    transitionScreen.classList.remove("show");
    if (cb) cb();
  }, 2000);
}

/* --------------------------
   Mic + Waveform
--------------------------- */
async function startMic(){
  stopMic();
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  analyser = audioCtx.createAnalyser();
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  micSource = audioCtx.createMediaStreamSource(stream);
  micSource.connect(analyser);
  analyser.fftSize = 512;
  dataArray = new Uint8Array(analyser.frequencyBinCount);
  running = true;
  requestAnimationFrame(draw);
}

function stopMic(){
  running = false;
  try { if (audioCtx) audioCtx.close(); } catch(e){}
  audioCtx = null; analyser = null; micSource = null; dataArray = null;
  begCtx.clearRect(0,0,begCanvas.width,begCanvas.height);
  mainCtx.clearRect(0,0,mainCanvas.width,mainCanvas.height);
}

function draw(){
  if (!running || !analyser) return;
  analyser.getByteTimeDomainData(dataArray);
  let sum = 0;
  for (let i=0;i<dataArray.length;i++){
    const v = (dataArray[i]-128)/128;
    sum += v*v;
  }
  const rms = Math.sqrt(sum / dataArray.length);
  if (mode !== "break" && mode !== "cum"){
    drawWave(begCtx, begCanvas, rms);
    drawWave(mainCtx, mainCanvas, rms);
  }

  if (mode === "beg" || mode === "begCum"){
    if (rms > 0.03){
      meterValue += 1.2;
      if (meterValue >= 100){
        if (mode === "beg") completeBeggingStep();
        else completeBegForCum();
        return;
      }
    } else meterValue = Math.max(0, meterValue - 0.3);
    begFill.style.width = meterValue + "%";
  } else if (mode === "tease"){
    if (rms > 0.03){
      meterValue += 3 + Math.random()*3;
      if (meterValue >= scenes[currentSceneIndex].goal){
        fillEl.style.width = "100%";
        completeTeaseScene();
        return;
      }
      try { chime.currentTime = 0; chime.play().catch(()=>{}); } catch(e){}
    } else meterValue = Math.max(0, meterValue - 0.5);
    fillEl.style.width = (meterValue / scenes[currentSceneIndex].goal * 100) + "%";
  }
  requestAnimationFrame(draw);
}

function drawWave(ctx, canvas, rms){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.beginPath();
  const amp = Math.min(rms * 80, canvas.height/2);
  for (let x=0; x<canvas.width; x++){
    const y = canvas.height/2 + Math.sin((x/30) + wavePhase) * amp;
    x===0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
  }
  ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--pink2');
  ctx.lineWidth = 2;
  ctx.stroke();
  wavePhase += 0.05;
}

/* --------------------------
   Flow
--------------------------- */
enterBtn.addEventListener("click", () => {
  try { enterSound.currentTime = 0; enterSound.play(); } catch(e){}
  enterScreen.classList.add("fade-out");
  setTimeout(() => {
    document.body.style.backgroundColor = "var(--bg)";
    startScreen.classList.add("show");
    setTimeout(playRandomStartSound, 2000);
  }, 3000);
});

function playRandomStartSound(){
  const i = Math.floor(Math.random() * 5) + 1;
  const s = new Audio(`Start${i}.mp3`);
  s.play().catch(()=>{});
}

beginBtn.addEventListener("click", () => {
  startScreen.classList.remove("show");
  setTimeout(() => startBeggingScene(0), 500);
});

/* Begging */
function startBeggingScene(index){
  beggingIndex = index;
  mode = "beg";
  meterValue = 0;
  beggingText.innerHTML = beggingScenes[index];
  begFill.style.width = "0%";
  beggingScreen.classList.add("show");
  stopMic(); startMic();
}

function completeBeggingStep(){
  stopMic();
  beggingScreen.classList.remove("show");
  showPopup("Good Girl.<br>You've earned what's next!", () => {
    if (beggingIndex < beggingScenes.length - 1){
      startBeggingScene(beggingIndex + 1);
    } else startTeaseScene(0);
  });
}

/* Teasing */
function startTeaseScene(index){
  currentSceneIndex = index;
  const s = scenes[index];
  if (s.title.includes("Gentle Break")) return startGentleBreak();
  mode = "tease";
  meterValue = 0;
  sceneTitle.textContent = s.title;
  line1.textContent = s.lines[0] || "";
  line2.textContent = s.lines[1] || "";
  line3.textContent = s.lines[2] || "";
  fillEl.style.width = "0%";
  stopMic(); startMic();
}

function completeTeaseScene(){
  stopMic();
  if (currentSceneIndex === scenes.length - 1) startBegForCum();
  else showPopup("Good Girl! You've pleased him well.", () => {
    transitionTo(() => startTeaseScene(currentSceneIndex + 1));
  });
}

/* Gentle Break */
function startGentleBreak(){
  mode = "break";
  stopMic();
  breakScreen.style.display = "flex";
  meterValue = 0; breakFill.style.width = "0%";
  const duration = Math.floor(Math.random()*10) + 10;
  const step = 100 / (duration * 60);
  function tick(){
    if (mode !== "break") return;
    meterValue += step;
    breakFill.style.width = meterValue + "%";
    if (meterValue >= 100){
      breakScreen.style.display = "none";
      showPopup("Enough resting.<br>Get back to that cock!", () => {
        transitionTo(() => startTeaseScene(currentSceneIndex + 1));
      });
    } else requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);
}

/* Beg for Cum */
function startBegForCum(){
  mode = "begCum";
  meterValue = 0; begFill.style.width = "0%";
  beggingText.innerHTML = begForCumScene;
  beggingScreen.classList.add("show");
  stopMic(); startMic();
}

function completeBegForCum(){
  stopMic();
  beggingScreen.classList.remove("show");
  showPopup("Good Girl.<br>You've earned his release.", startCumScene);
}

/* Cum Scene */
function startCumScene(){
  mode = "cum"; stopMic();
  cumScreen.style.display = "flex";
  let meterVal = 0;
  cumFill.style.width = "0%";
  const duration = Math.floor(Math.random()*11) + 5;
  const step = 100 / (duration * 60);
  function fill(){
    if (meterVal >= 90){
      const spurts = Math.floor(Math.random()*3) + 3;
      let i = 0; const remaining = 100 - meterVal;
      const perSpurt = remaining / spurts;
      function spurt(){
        if (i < spurts){
          meterVal = Math.min(100, meterVal + perSpurt);
          cumFill.style.width = meterVal + "%";
          i++;
          setTimeout(spurt, 150);
        } else {
          cumMeter.classList.add("shake");
          setTimeout(()=>{
            cumMeter.classList.remove("shake");
            triggerHeartsThenPopup();
          }, 300);
        }
      }
      spurt();
    } else {
      meterVal += step;
      cumFill.style.width = meterVal + "%";
      if (meterVal < 90) requestAnimationFrame(fill);
      else fill();
    }
  }
  requestAnimationFrame(fill);
}

function triggerHeartsThenPopup(){
  cumFill.style.background = "#fff";
  setTimeout(()=>{ cumFill.style.background = "var(--pink1)"; }, 150);
  const hearts = Math.floor(Math.random()*3) + 5;
  for (let i=0;i<hearts;i++){
    setTimeout(()=>{
      spawnHeart();
      try { popSound.currentTime = 0; popSound.play().catch(()=>{}); } catch(e){}
    }, i*100);
  }
  setTimeout(()=>{
    const ending = cumEndings[Math.floor(Math.random()*cumEndings.length)];
    showPopup(ending, ()=>console.log("Round complete"));
  }, hearts*120 + 500);
}

function spawnHeart(){
  const heart = document.createElement("div");
  heart.className = "heart";
  heart.innerHTML = "ðŸ©·";
  heart.style.left = (Math.random()*120 - 60) + "px";
  heart.style.top  = "0px";
  heartsContainer.appendChild(heart);
  setTimeout(()=>heart.remove(), 650);
}

/* Prevent double-tap zoom & context menu */
let lastTouchEnd = 0;
document.addEventListener('touchend', function(event) {
  const now = Date.now();
  if (now - lastTouchEnd <= 300) event.preventDefault();
  lastTouchEnd = now;
}, false);
document.addEventListener('contextmenu', e => e.preventDefault());
</script>
</body>
</html>
